- Написал начальный Terraform конфиг, юзая документацию.
- Собрал образы Docker приложения, NGINX и PostgreSQL, залил в них все настройки и проч. проч.
- Заполнил БД, сделал дамп и залил его в образ PostgreSQL для оптимизированной единоразовой подгрузки БД в docker volume.
- Оформил cloud-init и перенес в него docker-compose файлы, которые раньше получал через wget с GitHub.
- Решил проблему bingo с DNS, перенаправив его запросы с 80 порта на 53 через iptables.
- Решил проблему bingo с I feel bad через healthcheck докера, отправляя его на тот свет с появлением этого сообщения.
- Решил проблему жирных запросов к БД её индексацией и закручиванием гаек через конфиг PostgreSQL.
- Оформил кэширование, распределение нагрузки, http, https и http3 через nginx.
- Убрал статические IP адреса и решил проблему добавлением внутреннего DNS сервера и записью, ведущей к виртуалке с PostgreSQL.
- Закрыл доступ к PostgreSQL извне через iptables.
- Добавил постоянное доменное имя виртуалке с приложением через внешний DNS сервер. Добавил NS запись на свой сервер, которая ведет к DNS серверу Yandex Cloud, поэтому bingo.neverservers.ru
по факту резолвится DNS'кой облака.
- Сделал нормальный сертификат, так как есть нормальный домен.
- Из-за того, что убрал статические адреса, пришлось чинить конфиги, которые на эти адреса ссылались. Решил проблему с nginx создав внутреннюю сеть между контейнерами и оформил обращения nginx'а
к контейнерам с приложением через их имена (uno-bingo:7962 и des-bingo:7962).
- Графики и логи оформить времени не хватило, поэтому дропаю их в /dev/null.
